(this["webpackJsonppm-node-attrs-yjs-snapshots"]=this["webpackJsonppm-node-attrs-yjs-snapshots"]||[]).push([[0],{279:function(e,t,n){},280:function(e,t,n){},281:function(e,t,n){},282:function(e,t,n){},283:function(e,t,n){},284:function(e,t,n){"use strict";n.r(t);var r,i,a,s,o,c=n(0),d=n(68),l=n(85),u=n(25),h=n(19),v=n(120),b=n(29),p=n(20),f=n(8),j=function(e){var t=e.className;return Object(f.jsx)(g,{className:t,children:Object(f.jsx)(m,{children:Object(f.jsx)(O,{to:"/",exact:!0,activeClassName:"current",children:"Front page"})})})},g=p.a.div(r||(r=Object(h.a)(["\n  background: var(--color-primary);\n  box-shadow: 0 0 2px 2px rgba(0,0,0,0.18);\n  padding: 1rem;\n"]))),m=p.a.nav(i||(i=Object(h.a)(["\n  align-items: center;\n  color: #fff;\n  display: flex;\n"]))),O=Object(p.a)(l.b)(a||(a=Object(h.a)(["\n  box-sizing: border-box;\n  color: #fff;\n  cursor: pointer;\n  font-size: 1rem;\n  padding: 0.5rem 1rem;\n  text-decoration: none;\n  transition: 0.2s hover;\n  &:hover {\n    text-decoration: underline;\n  }\n  &.current {\n    font-weight: 600;\n  }\n"]))),y=["component"],x=function(e){var t,n=e.component,r=Object(v.a)(e,y);return Object(f.jsx)(u.b,Object(b.a)(Object(b.a)({},r),{},{render:(t=n,function(e){return Object(f.jsxs)(w,{children:[Object(f.jsx)(j,Object(b.a)({},e)),Object(f.jsx)(k,{children:Object(f.jsx)(t,Object(b.a)({},e))})]})})}))},w=p.a.div(s||(s=Object(h.a)(["\n  min-height: 100vh;\n"]))),k=p.a.main(o||(o=Object(h.a)(["\n  margin: 40px auto 0 auto;\n  max-width: 800px;\n  padding-bottom: 20px;\n  @media only screen and (max-width: 720px) {\n    margin: 40px 20px 0 20px;\n    padding-bottom: 20px;\n  }\n"]))),_=n(154),M=n(75),D=n(2),S=n(4),P=n(3),E=function(){function e(){Object(D.a)(this,e),this._view=void 0}return Object(S.a)(e,[{key:"init",value:function(e){this._view=e}},{key:"view",get:function(){if(!this._view)throw Error("EditorViewProvider view accessed without EditorView instance");return this._view}},{key:"execCommand",value:function(e){e(this.view.state,this.view.dispatch),this.focus()}},{key:"focus",value:function(){return!(!this._view||this._view.hasFocus())&&(this._view.focus(),this._view.dispatch(this._view.state.tr.scrollIntoView()),!0)}},{key:"stateToJSON",value:function(){var e=this.view.state.toJSON();return Object(b.a)(Object(b.a)({},e),{},{plugins:[]})}},{key:"hydrateStateFromJSON",value:function(e){var t=P.b.fromJSON({schema:this.view.state.schema,plugins:this.view.state.plugins},e);this.view.updateState(t),this.view.dispatch(this.view.state.tr)}},{key:"replaceState",value:function(e){this.view.updateState(e),this.view.dispatch(this.view.state.tr)}}]),e}(),N=n(7),A=n(16),U=function(){function e(){Object(D.a)(this,e),this._observers=new Map}return Object(S.a)(e,[{key:"on",value:function(e,t){var n=this._observers.get(e);n?this._observers.set(e,new Set(n.add(t))):this._observers.set(e,new Set([t]))}},{key:"off",value:function(e,t){var n=this._observers.get(e);n&&(n.delete(t),0===n.size&&this._observers.delete(e))}},{key:"emit",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return Array.from((this._observers.get(e)||new Set).values()).forEach((function(e){return e.apply(void 0,n)}))}},{key:"destroy",value:function(){this._observers=new Map}}]),e}();var z,C,I,F,R=function(){function e(t,n){var r=this;Object(D.a)(this,e),this._observable=new U,this.viewProvider=void 0,this.yjsProvider=void 0,this.snapshots=new N.a,this.selectedSnapshot=null,this.viewProvider=t,this.yjsProvider=n,n.onInit((function(){var e=r;n.ydoc.getArray("pm-doc-versions").observe((function t(){e.updateVersions(),n.ydoc.getArray("pm-doc-versions").unobserve(t)}))}))}return Object(S.a)(e,[{key:"state",get:function(){return{snapshots:this.snapshots,selectedSnapshot:this.selectedSnapshot}}},{key:"updateVersions",value:function(){var e=this.yjsProvider.ydoc.getArray("pm-doc-versions");this.snapshots=e,this._observable.emit("update",this.state)}},{key:"createSnapshot",value:function(){var e=this.yjsProvider.ydoc,t=e.getArray("pm-doc-versions"),n=0===t.length?null:t.get(t.length-1);console.info(n);var r,i,a=null===n?N.x:N.w(n.snapshot),s=N.G(e);if(console.info("created snapshot",s),null!=n){var o=a.sv.get(n.clientID);if(!o)throw Error("Yjs prevVersionID was undefined!");a.sv.set(n.clientID,o+1)}N.B(a,s)||(t.push([(r=s,i=e.clientID,{date:(new Date).getTime(),snapshot:N.y(r),clientID:i})]),this.updateVersions())}},{key:"inspectSnapshot",value:function(e){var t;if(console.log("snap",e),!e||(null===(t=this.selectedSnapshot)||void 0===t?void 0:t.date)===e.date)return this.resumeEditing();var n=this.yjsProvider.ydoc.getArray("pm-doc-versions"),r=N.w(e.snapshot);console.log("inspect snapshot",r);var i=N.x,a=!1;n.forEach((function(t){t.date===e.date?a=!0:a||(i=N.w(t.snapshot))}));var s=A.b.getState(this.viewProvider.view.state).binding;s&&s.renderSnapshot(r,i),this.selectedSnapshot=e,this._observable.emit("update",this.state)}},{key:"deleteSnapshot",value:function(e){var t=this,n=this.yjsProvider.ydoc.getArray("pm-doc-versions");n.forEach((function(r,i){r.date===e.date&&(n.delete(i),t._observable.emit("update",t.state))}))}},{key:"resumeEditing",value:function(){var e=A.b.getState(this.viewProvider.view.state).binding;e&&e.unrenderSnapshot(),this.selectedSnapshot=null,this._observable.emit("update",this.state)}},{key:"onUpdate",value:function(e){this._observable.on("update",e)}},{key:"offUpdate",value:function(e){this._observable.off("update",e)}}]),e}(),V=n(151),X=[{username:"Alice",color:"#ecd444",lightColor:"#ecd44433"},{username:"Bob",color:"#ee6352",lightColor:"#ee635233"},{username:"Max",color:"#6eeb83",lightColor:"#6eeb8333"}],J=function(){function e(t){Object(D.a)(this,e),this._observable=new U,this.viewProvider=void 0,this._ydoc=void 0,this._permanentUserData=void 0,this._provider=void 0,this._yXmlFragment=void 0,this.viewProvider=t}return Object(S.a)(e,[{key:"ydoc",get:function(){if(!this._ydoc)throw Error("YjsProvider ydoc accessed without initialization!");return this._ydoc}},{key:"provider",get:function(){if(!this._provider)throw Error("YjsProvider provider accessed without initialization!");return this._provider}},{key:"yXmlFragment",get:function(){if(!this._yXmlFragment)throw Error("YjsProvider yXmlFragment accessed without initialization!");return this._yXmlFragment}},{key:"permanentUserData",get:function(){if(!this._permanentUserData)throw Error("YjsProvider permanentUserData accessed without initialization!");return this._permanentUserData}},{key:"init",value:function(){this._ydoc=new N.e,this._permanentUserData=new N.g(this._ydoc);var e=X[Math.floor(3*Math.random())];this._permanentUserData.setUserMapping(this._ydoc,this._ydoc.clientID,e.username),this._ydoc.gc=!1,this._provider=new V.a("wss://demos.yjs.dev","prosemirror-versions-demo",this._ydoc),this._yXmlFragment=this._ydoc.getXmlFragment("pm-doc"),this._observable.emit("init")}},{key:"onInit",value:function(e){this._observable.on("init",e)}},{key:"offInit",value:function(e){this._observable.off("init",e)}}]),e}(),Y=function(){var e=new E,t=new J(e);return{viewProvider:e,snapshotProvider:new R(e,t),yjsProvider:t}},T=Object(c.createContext)(Y()),q=function(){return Object(c.useContext)(T)},B=[{title:"update-attribute",icon:Object(f.jsx)(M.a,{size:16})}];function G(e){var t=e.className,n=q().viewProvider;return Object(f.jsx)(W,{className:t,children:Object(f.jsx)(K,{children:B.map((function(e){return Object(f.jsx)($,{children:Object(f.jsx)(H,{onClick:function(){return function(e){switch(e){case"update-attribute":return void n.execCommand((function(e,t){var n,r=e.selection.head,i=e.doc.resolve(r).start(1)-1,a=e.doc.nodeAt(i);return n=(null===a||void 0===a?void 0:a.attrs.makeMeRed)?e.tr.setNodeMarkup(i,void 0,{makeMeRed:!1}):e.tr.setNodeMarkup(i,void 0,{makeMeRed:!0}),!!t&&(t(n),!0)}))}}(e.title)},children:e.icon})},e.title)}))})})}var L,W=p.a.div(z||(z=Object(h.a)(["\n  background: var(--color-primary-lighter);\n  padding: 1rem;\n"]))),K=p.a.div(C||(C=Object(h.a)(["\n  align-items: center;\n  color: #fff;\n  display: flex;\n  list-style: none;\n  margin: 0;\n  padding: 0;\n"]))),$=p.a.li(I||(I=Object(h.a)(["\n  & + & {\n    margin-left: 1rem;\n  }\n"]))),H=p.a.button(F||(F=Object(h.a)(["\n  align-items: center;\n  background: transparent;\n  border: 0;\n  border-radius: 4px;\n  cursor: pointer;\n  display: flex;\n  padding: 0.25rem;\n  &:hover {\n    background: rgba(255, 255, 255, 0.7);\n    opacity: 0.7;\n  }\n  &.active {\n    background: rgb(215 227 255);\n    box-shadow: 0 0 2px 2px rgb(0 0 0 / 18%);\n  }\n"])));function Q(e){var t=e.className,n=q().snapshotProvider;return Object(f.jsx)(ae,{className:t,children:Object(f.jsx)("button",{onClick:function(){n.createSnapshot()},children:"Snapshot"})})}var Z,ee,te,ne,re,ie,ae=p.a.div(L||(L=Object(h.a)(["\n  display: flex;\n  flex-direction: column;\n  flex-wrap: wrap;\n  button {\n    margin: 0.05rem;\n  }\n"]))),se=n(21);function oe(e){var t=e.className,n=Object(c.useState)(!0),r=Object(se.a)(n,2),i=r[0],a=r[1],s=q().snapshotProvider,o=function(){var e=q().snapshotProvider,t=Object(c.useState)(e.state),n=Object(se.a)(t,2),r=n[0],i=n[1];return Object(c.useEffect)((function(){var t=function(e){i(e)};return i(e.state),e.onUpdate(t),function(){e.offUpdate(t)}}),[e]),r}();return Object(f.jsxs)(f.Fragment,{children:[Object(f.jsxs)(de,{children:[Object(f.jsxs)("button",{onClick:function(){return a(!i)},className:"header-btn",children:[Object(f.jsx)("span",{children:i?Object(f.jsx)(M.b,{size:16}):Object(f.jsx)(M.c,{size:16})}),Object(f.jsx)(le,{children:"Snapshots"})]}),Object(f.jsx)("button",{className:"inspect-btn ".concat(o.selectedSnapshot?"":"hidden"),onClick:function(){s.resumeEditing()},children:"Stop inspecting"})]}),Object(f.jsx)(ue,{className:"".concat(t," ").concat(i?"":"hidden"),children:null===o||void 0===o?void 0:o.snapshots.map((function(e,t){return Object(f.jsxs)(he,{children:[Object(f.jsxs)(ve,{children:[Object(f.jsxs)("h4",{children:["Snapshot ",t+1]}),Object(f.jsxs)(be,{children:[Object(f.jsx)("button",{onClick:function(){return function(e){s.inspectSnapshot(e)}(e)},children:"Inspect"}),Object(f.jsx)("button",{onClick:function(){return function(e){s.deleteSnapshot(e)}(e)},children:"Delete"})]})]}),Object(f.jsx)("small",{children:new Date(e.date).toLocaleString()})]},"".concat(e.date,"-").concat(t))}))})]})}var ce,de=p.a.div(Z||(Z=Object(h.a)(["\n  align-items: center;\n  display: flex;\n  margin: 1rem 0 0.5rem 0;\n  & > .header-btn {\n    align-items: center;\n    background: transparent;\n    border: 0;\n    cursor: pointer;\n    display: flex;\n    margin: 0;\n    padding: 0;\n  }\n  & > .inspect-btn {\n    margin-left: 1rem;\n  }\n  .hidden {\n    visibility: hidden;\n  }\n"]))),le=p.a.h3(ee||(ee=Object(h.a)(["\n  font-size: 1rem;\n  font-weight: 400;\n  margin: 0 0 0 0.5rem;\n  text-transform: uppercase;\n"]))),ue=p.a.ul(te||(te=Object(h.a)(["\n  display: flex;\n  flex-direction: column;\n  list-style: none;\n  margin: 0;\n  max-height: 300px;\n  overflow-y: scroll;\n  padding: 0;\n  &.hidden {\n    display: none;\n    visibility: hidden;\n  }\n  & > li:nth-child(odd) {\n    background: #f3f3f3;\n  }\n"]))),he=p.a.li(ne||(ne=Object(h.a)(["\n  border-radius: 2px;\n  padding: 0.25rem;\n"]))),ve=p.a.div(re||(re=Object(h.a)(["\n  align-items: center;\n  display: flex;\n  justify-content: space-between;\n  & > h4 {\n    margin: 0;\n    margin-right: 1rem;\n  }\n"]))),be=p.a.div(ie||(ie=Object(h.a)(["\n  display: flex;\n  margin: 0.25rem 0;\n  button + button {\n    margin-left: 0.5rem;\n  }\n"])));function pe(){return Object(f.jsxs)(ge,{children:[Object(f.jsx)(Q,{className:"changes-controls"}),Object(f.jsx)(oe,{})]})}var fe,je,ge=p.a.div(ce||(ce=Object(h.a)([""]))),me=n(39),Oe=n(27),ye=new(n(1).i)({nodes:{doc:{content:"block+"},paragraph:{attrs:{makeMeRed:{default:null}},content:"inline*",group:"block",parseDOM:[{tag:"p"}],toDOM:function(e){return["p",{style:e.attrs.makeMeRed?"background: red;":void 0},0]}},blockquote:{attrs:{makeMeRed:{default:null}},content:"block+",group:"block",defining:!0,parseDOM:[{tag:"blockquote"}],toDOM:function(e){return["blockquote",{style:e.attrs.makeMeRed?"background: red;":void 0},0]}},horizontal_rule:{group:"block",parseDOM:[{tag:"hr"}],toDOM:function(){return["hr"]}},heading:{attrs:{level:{default:1}},content:"inline*",group:"block",defining:!0,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}],toDOM:function(e){return["h"+e.attrs.level,0]}},code_block:{content:"text*",marks:"",group:"block",code:!0,defining:!0,parseDOM:[{tag:"pre",preserveWhitespace:"full"}],toDOM:function(){return["pre",["code",0]]}},text:{group:"inline"},image:{inline:!0,attrs:{src:{},alt:{default:null},title:{default:null}},group:"inline",draggable:!0,parseDOM:[{tag:"img[src]",getAttrs:function(e){var t=e;return{src:t.getAttribute("src"),title:t.getAttribute("title"),alt:t.getAttribute("alt")}}}],toDOM:function(e){var t=e.attrs;return["img",{src:t.src,alt:t.alt,title:t.title}]}},hard_break:{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}],toDOM:function(){return["br"]}}},marks:{link:{attrs:{href:{},title:{default:null}},inclusive:!1,parseDOM:[{tag:"a[href]",getAttrs:function(e){var t=e;return{href:t.getAttribute("href"),title:t.getAttribute("title")}}}],toDOM:function(e){var t=e.attrs;return["a",{href:t.href,title:t.title},0]}},italic:{parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style=italic"}],toDOM:function(){return["em",0]}},bold:{parseDOM:[{tag:"strong"},{tag:"b",getAttrs:function(e){return"normal"!=e.style.fontWeight&&null}},{style:"font-weight",getAttrs:function(e){return/^(bold(er)?|[5-9]\d{2,})$/.test(e)&&null}}],toDOM:function(){return["strong",0]}},code:{parseDOM:[{tag:"code"}],toDOM:function(){return["code",0]}},strikethrough:{parseDOM:[{tag:"s"},{tag:"strike"},{style:"text-decoration=line-through"},{style:"text-decoration-line=line-through"}],toDOM:function(){return["s"]}},ychange:{attrs:{user:{default:null},type:{default:null},color:{default:null}},inclusive:!1,parseDOM:[{tag:"ychange"}],toDOM:function(e){return["ychange",{ychange_user:e.attrs.user,ychange_type:e.attrs.type,style:xe(e.attrs),ychange_color:e.attrs.color.light}].concat(Object(Oe.a)(we(e.attrs,[0])))}}}}),xe=function(e){switch(e.type){case"removed":return"color:".concat(e.color.dark);case"added":return"background-color:".concat(e.color.light);case null:return""}},we=function(e,t){return null===e?t:[["span",{class:"ychange-hover",style:"background-color:".concat(e.color.dark)},e.user||"Unknown"],["span"].concat(Object(Oe.a)(t))]},ke=n(155),_e=n(55),Me=n(91),De=n(288),Se=n(289),Pe=function(e){return[Object(Me.c)(e.yjsProvider.yXmlFragment,{permanentUserData:e.yjsProvider.permanentUserData,colors:[{light:"#ecd44433",dark:"#ecd444"},{light:"#ee635233",dark:"#ee6352"},{light:"#6eeb8333",dark:"#6eeb83"}]}),Object(De.a)(e.yjsProvider.provider.awareness),Object(Se.c)(),Object(_e.b)({"Mod-z":Se.b,"Mod-y":Se.a,"Mod-Shift-z":Se.a})].concat(Object(ke.a)({schema:ye,history:!1}))};n(279),n(280),n(281),n(282);function Ee(e){var t=e.className,n=void 0===t?"":t,r=Object(c.useRef)(null),i=Object(c.useRef)(null),a=q();function s(t){if(i.current){var n=i.current.state.apply(t);i.current.updateState(n),e.onEdit&&e.onEdit(n)}}return Object(c.useLayoutEffect)((function(){a.yjsProvider.init();var t=function(e){return P.b.create({schema:ye,plugins:Pe(e)})}(a),n=r.current;return n&&(i.current=function(e,t){var n=new me.c({mount:e},{state:t,dispatchTransaction:s});window&&(window.editorView=n);return n}(n,t),a.viewProvider.init(i.current),e.onEditorReady&&(null===e||void 0===e||e.onEditorReady(a))),function(){var e;null===(e=i.current)||void 0===e||e.destroy()}}),[]),Object(f.jsx)("div",{id:"example-editor",ref:r,className:n})}function Ne(){var e=Object(c.useMemo)((function(){return Y()}),[]);return Object(f.jsx)(T.Provider,{value:e,children:Object(f.jsx)("div",{children:Object(f.jsxs)(Ue,{children:[Object(f.jsxs)(ze,{children:[Object(f.jsx)(G,{className:"toolbar 'full-width"}),Object(f.jsx)("div",{className:"pm-editor full-width",children:Object(f.jsx)(Ee,{onEditorReady:function(e){Object(_.a)(e.viewProvider.view)}})})]}),Object(f.jsx)(pe,{})]})})})}var Ae,Ue=p.a.div(fe||(fe=Object(h.a)(["\n  display: grid;\n  grid-template-columns: 2fr 1fr;\n  grid-template-rows: auto auto;\n  margin-top: 1rem;\n"]))),ze=p.a.div(je||(je=Object(h.a)(["\n  margin-right: 1rem;\n"])));function Ce(){return Object(f.jsxs)(Ie,{children:[Object(f.jsxs)("header",{children:[Object(f.jsx)("h1",{children:Object(f.jsx)("a",{href:"https://teemukoivisto.github.io/pm-node-attrs-yjs-snapshots/",children:"ProseMirror node attributes persistence with Yjs snapshots"})}),Object(f.jsx)("p",{children:"Somehow I can't get them to work"}),Object(f.jsx)("p",{children:Object(f.jsx)("a",{href:"https://github.com/TeemuKoivisto/pm-node-attrs-yjs-snapshots",children:"Github repo"})})]}),Object(f.jsx)(Ne,{})]})}var Ie=p.a.div(Ae||(Ae=Object(h.a)([""]))),Fe=function(){return Object(f.jsx)(l.a,{basename:"/pm-node-attrs-yjs-snapshots",children:Object(f.jsxs)(u.d,{children:[Object(f.jsx)(x,{exact:!0,path:"/",component:Ce}),Object(f.jsx)(u.a,{to:"/"})]})})};n(283);Object(d.render)(Object(f.jsx)(Fe,{}),document.getElementById("root"))}},[[284,1,2]]]);
//# sourceMappingURL=main.735a7e32.chunk.js.map